import asyncio
import logging
from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import Command
from aiogram.types import WebAppInfo

# 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
# –°—é–¥–∞ –≤—Å—Ç–∞–≤—å —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–ª BotFather
TOKEN = "8595417826:AAH4bCiGjFZrt1pZ8Kdrw57C4G5Gd1Vy9hE" 

# –°—é–¥–∞ –≤—Å—Ç–∞–≤—å —Ç—É —Å–∞–º—É—é —Å—Å—ã–ª–∫—É, –∫–æ—Ç–æ—Ä—É—é –º—ã –ø–æ–ª—É—á–∏–ª–∏ –Ω–∞ GitHub Pages
WEBAPP_URL = "https://k0ra09.github.io/rusreef_bot/webapp/index.html"

# –í–∫–ª—é—á–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –±–æ—Ç–æ–º
logging.basicConfig(level=logging.INFO)

# –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
# –î–∏—Å–ø–µ—Ç—á–µ—Ä (dp) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot = Bot(token=TOKEN)
dp = Dispatcher()

# 2. –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò (HANDLERS)

# –≠—Ç–æ—Ç –±–ª–æ–∫ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ —é–∑–µ—Ä –ø–∏—à–µ—Ç –∫–æ–º–∞–Ω–¥—É /start
@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    """
    –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è WebApp.
    """
    
    # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É. 
    # –í –ø–∞—Ä–∞–º–µ—Ç—Ä web_app –º—ã –ø–µ—Ä–µ–¥–∞–µ–º –Ω–∞—à—É —Å—Å—ã–ª–∫—É.
    # –≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –¢–µ–ª–µ–≥—Ä–∞–º—É: "–ü–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–µ —à–ª–∏ —Ç–µ–∫—Å—Ç, –∞ –æ—Ç–∫—Ä–æ–π –æ–∫–Ω–æ".
    keyboard = types.ReplyKeyboardMarkup(
        keyboard=[
            [types.KeyboardButton(text="üåä –û—Ç–∫—Ä—ã—Ç—å –î–Ω–µ–≤–Ω–∏–∫", web_app=WebAppInfo(url=WEBAPP_URL))]
        ],
        resize_keyboard=True # –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π
    )

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
    await message.answer(
        "–ü—Ä–∏–≤–µ—Ç! –Ø RusReef Bot.\n–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –∞–∫–≤–∞—Ä–∏—É–º–æ–º.",
        reply_markup=keyboard
    )

# 3. –ó–ê–ü–£–°–ö
async def main():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞.
    """
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—á—Ç–æ–±—ã –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–ª –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø—Ä–∏—Å–ª–∞–Ω–Ω—ã–µ, –ø–æ–∫–∞ –æ–Ω —Å–ø–∞–ª)
    await bot.delete_webhook(drop_pending_updates=True)
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –æ–ø—Ä–æ—Å —Å–µ—Ä–≤–µ—Ä–æ–≤ –¢–µ–ª–µ–≥—Ä–∞–º–∞ (polling)
    await dp.start_polling(bot)

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Python —Å–∫—Ä–∏–ø—Ç–∞
if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("–ë–æ—Ç –≤—ã–∫–ª—é—á–µ–Ω")